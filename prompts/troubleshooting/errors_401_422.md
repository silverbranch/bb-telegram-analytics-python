# Troubleshooting: 401 and 422 Errors

## 401 Unauthorized

**Symptoms:** SDK logs a warning: `BB API event X failed: 401 ...` (or similar). Events are not recorded in BB dashboard.

**Likely cause:** Invalid or missing integration key. The API expects `Authorization: Bearer <key>`.

**Checks:**
- Is `BB_INTEGRATION_KEY` set in the environment?
- Is the key correct? Copy it from BB admin panel without extra spaces or newlines.
- Is the key for the correct environment (bb-bot.ru vs bb.center)?

**Fixes:**
1. Verify `BB_INTEGRATION_KEY` in `.env` or Docker `environment`.
2. Ensure no typo in the variable name.
3. Regenerate the key in BB admin if it was rotated.
4. Confirm `BB_API_BASE_URL` matches the backend that issued the key.

---

## 422 Validation Error

**Symptoms:** SDK logs: `BB API event X failed: 422 ...`. Response body may mention validation.

**Likely cause:** Payload or request body does not match the API contract. The API requires `event_name`, `occurred_at`, `idempotency_key`; the SDK sets these automatically. Validation errors usually come from custom payloads or direct API calls.

**Checks:**
- Is `payload` JSON-serializable? (dict, str, int, float, list, bool; no custom objects)
- Are payload keys/values flat and simple? (API may reject nested or unusual structures)
- If calling the API directly: does the body include `event_name`, `occurred_at`, `idempotency_key`?

**Fixes:**
1. Use flat dict for `payload`: `{"handler": "start", "source": "telegram"}`.
2. Ensure no secrets in payload (API may reject or truncate).
3. Use snake_case for payload keys.
4. If integrating a custom client: match the SDKâ€™s body shape exactly.
